<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Termoseras — Contatti</title>
    <meta name="description" content="Scopini di ricambio e teste in ottone per l’industria del bagno. Qualità assoluta, produzione interna, incastri e filetti.">
    <link rel="stylesheet" href="style.css" />
    <link rel="preload" as="font" href="assets/fonts/montserrat-400.woff2" type="font/woff2" crossorigin>
<link rel="preload" as="font" href="assets/fonts/montserrat-600.woff2" type="font/woff2" crossorigin>

    <link rel="icon" type="image/png" href="assets/darklogo.png" media="(prefers-color-scheme: light)">
    <link rel="icon" type="image/png" href="assets/lightlogo.png" media="(prefers-color-scheme: dark)">

    <!-- Cookie banner (CSS) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.1.0/dist/cookieconsent.css">
    <!-- IframeManager (CSS) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orestbida/iframemanager@1.3.0/dist/iframemanager.css">

    <!-- Google Consent Mode: default = denied -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('consent','default',{
        ad_storage:'denied',
        ad_user_data:'denied',
        ad_personalization:'denied',
        analytics_storage:'denied',
        functionality_storage:'denied',
        personalization_storage:'denied',
        security_storage:'denied'
      });
    </script>
  </head>
  <body>
    <!-- HEADER -->
    <header class="site-header" role="banner">
      <div class="container site-nav">
        <a class="brand" href="index.html">
          <img src="assets/soloscritta.svg" class="logo-desktop-left">
          <img src="assets/logo.svg" class="logo-mobile-left">
        </a>
        <div class="logo-center">
          <img src="assets/logo.svg">
        </div>
        <a class="burger" href="menu.html" aria-label="Apri menu">
          <span class="burger__bar"></span>
          <span class="burger__bar"></span>
          <span class="burger__bar"></span>
        </a>
        <nav class="nav-links" aria-label="Navigazione principale">
          <a href="index.html">Home</a>
          <a href="prodotti.html">Prodotti</a>
          <a href="chi-siamo.html">Chi siamo</a>
          <a href="contatti.html">Contatti</a>
        </nav>
      </div>
    </header>

    <!-- HERO -->
    <section class="hero hero--centered" style="--hero:url('assets/hero-contatti.svg')" aria-label="Contatti">
      <div class="container hero__inner">
        <h1 class="hero__title">Contatti</h1>
        <p class="hero__text">Informazioni e riferimenti</p>
        <a class="btn" href="#contattaci">Vai al form</a>
      </div>
    </section>

    <!-- FORM + CONTATTI DIRETTI -->
    <section class="section" id="contattaci" aria-label="Contattaci">
      <div class="container">
        <div class="section__head">
          <h2 class="section__title">Contattaci</h2>
        </div>
        <div class="contact-grid">
          <!-- CARD: FORM -->
          <div class="card card--full">
            <div class="card__body">
              <form class="form form--compact" id="contact-form" method="post" action="#">
                <div class="field-wrap">
                  <input class="field" type="text" name="azienda" placeholder="Azienda *" required aria-label="Azienda">
                </div>
                <div class="field-wrap">
                  <input class="field" type="text" name="nominativo" placeholder="Nome e cognome *" required aria-label="Nome e cognome">
                </div>
                <div class="field-wrap">
                  <input class="field" id="email" type="email" name="email" placeholder="Email *" required aria-label="Email" pattern="^[^\s@]+@[^\s@]+\.[^\s@]{2,}$">
                  <div class="error-text" id="email-error"></div>
                </div>
                <div class="field-wrap">
                  <input class="field" id="telefono" type="tel" name="telefono" placeholder="Telefono (es. +39 02 1234567)" aria-label="Telefono" inputmode="tel" pattern="[0-9()+.\s-]{7,20}">
                  <div class="error-text" id="tel-error"></div>
                </div>
                <fieldset class="full" style="margin-top:6px">
                  <div class="legend">Tipo di richiesta</div>
                  <div class="radios">
                    <label class="radio"><input type="radio" name="tipo_richiesta" value="Preventivo" checked><span>Preventivo</span></label>
                    <label class="radio"><input type="radio" name="tipo_richiesta" value="Campioni"><span>Campioni</span></label>
                    <label class="radio"><input type="radio" name="tipo_richiesta" value="Informazioni"><span>Informazioni</span></label>
                  </div>
                </fieldset>
                <fieldset class="full" style="margin-top:6px">
                  <div class="legend">Articoli di interesse (multipla, facoltativa)</div>
                  <div class="checks-grid" id="articoli-list">
                    <label class="check"><input type="checkbox" name="articoli[]" value="Nocciolo" data-key="nocciolo"><span>Nocciolo</span></label>
                    <label class="check"><input type="checkbox" name="articoli[]" value="Scopino" data-key="scopino"><span>Scopino</span></label>
                    <label class="check"><input type="checkbox" name="articoli[]" value="Riccio in PVC" data-key="riccio"><span>Riccio in PVC</span></label>
                    <label class="check"><input type="checkbox" name="articoli[]" value="Manico per riccio" data-key="manico"><span>Manico per riccio</span></label>
                    <label class="check"><input type="checkbox" name="articoli[]" value="Tazze" data-key="tazze"><span>Tazze</span></label>
                    <label class="check"><input type="checkbox" name="articoli[]" value="Rullino portarotoli" data-key="rullino"><span>Rullino portarotoli</span></label>
                  </div>
                </fieldset>
                <fieldset id="versions-fieldset" class="full" hidden>
                  <div class="legend">Versioni (facoltative, dipendono dagli articoli selezionati)</div>
                  <div id="versions-container"></div>
                </fieldset>
                <div class="field-wrap full">
                  <textarea class="field textarea" name="messaggio" rows="6" placeholder="Messaggio (incastri/filetti, rasatura Ø, colori, note) *" required aria-label="Messaggio"></textarea>
                </div>
                <div class="full" style="margin-top:-4px">
                  <label style="display:flex;align-items:flex-start;gap:10px;line-height:1.4; color:var(--muted)">
                    <input type="checkbox" id="privacy" name="privacy" required aria-label="Accetto la privacy" style="margin-top:4px">
                    <span>Ho letto e accetto la <a href="privacy.html" style="text-decoration:underline">Privacy Policy</a>.</span>
                  </label>
                </div>
                <div class="full" style="display:flex; flex-direction:column; align-items:flex-end; gap:6px; margin-top:6px">
                  <button class="btn" type="submit">Invia richiesta</button>
                  <p id="form-status" role="status" aria-live="polite" style="margin:0; color:var(--muted);"></p>
                </div>
              </form>
            </div>
          </div>

          <!-- CARD: CONTATTI DIRETTI -->
          <aside class="card contact-card">
            <div class="card__body">
              <h3 class="card__title" style="margin-bottom:6px">Contatti diretti</h3>
              <p class="card__text" style="margin-bottom:8px">Preferisci scrivere o chiamare?</p>
              <div class="contact-links">
                <a href="mailto:info@termoseras.it"><span>✉︎</span><span>a.morandini@treasrl.it</span></a>
                <a href="tel:+39021234567"><span>☎︎</span><span>+39 030 708 0274</span></a>
              </div>
              <p class="card__text" style="margin-top:10px;color:var(--muted)">Lun–Ven 8:00–12:00 / 13:30–17:30 <br> Sab–Dom chiuso </p>
            </div>
          </aside>
        </div>
      </div>
    </section>

    <!-- MAPPA / DOVE TROVARCI -->
    <section class="section" aria-label="Dove trovarci">
      <div class="container">
        <div class="section__head">
          <h2 class="section__title">Dove trovarci</h2>
        </div>
        <div class="card" style="overflow:hidden">
          <div class="card__body" style="padding:0">
            <div
              data-service="googlemaps"
              data-id="!1m18!1m12!1m3!1d1398.1568028905995!2d9.951244438566913!3d45.503765272629686!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47816c8165ee2285%3A0x2d5e08bbb129addc!2sVia%20del%20Lavoro%2C%2040%2C%2025030%20Castelcovati%20BS!5e0!3m2!1sit!2sit!4v1759220929383!5m2!1sit!2sit"
              data-title="Mappa bloccata"
              data-widget
              style="display:block; width:100%; height:420px;"></div>
          </div>
          <div class="card__body" style="display:flex;gap:18px;flex-wrap:wrap">
            <div style="min-width:240px">
              <h3 class="card__title" style="margin-bottom:6px">Indirizzo</h3>
              <p class="card__text" style="margin:0">Via del Lavoro, 40 <br> 25030 Castelcovati (BS) — Italia</p>
            </div>
            <div style="min-width:240px">
              <h3 class="card__title" style="margin-bottom:6px">Orari</h3>
              <p class="card__text" style="margin:0">Lun–Ven 8:00–12:00 / 13:30–17:30 <br> Sab–Dom chiuso</p>
            </div>
            <div style="min-width:240px">
              <h3 class="card__title" style="margin-bottom:6px">Accesso</h3>
              <p class="card__text" style="margin:0">Ingresso carico/scarico mezzi <br> Parcheggio clienti esterno</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="section">
      <div class="container">
        <div class="cta">
          <div>
            <div class="eyebrow">Ordini B2B</div>
            <h3 style="margin:6px 0 8px">MOQ 100 pezzi • Campioni disponibili</h3>
            <p style="margin:0;color:var(--muted)">Indica varianti, diametri e filetti: prepariamo campioni su richiesta per la valutazione del prodotto.</p>
          </div>
          <a class="btn" href="contatti.html#contattaci">Richiedi preventivo</a>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="site-footer" id="footer">
      <div class="container">
        <div class="footer-grid">
          <div class="footer-col">
            <h4 class="footer-col__title">TERMOSERAS</h4>
            <p>Parte del <strong>Gruppo Tre A</strong></p>
            <img width="100px" src="assets/logotrea.svg">
          </div>
          <div class="footer-col">
            <h4 class="footer-col__title">AZIENDA</h4>
            <a href="chi-siamo.html">Chi siamo</a>
            <a href="contatti.html">Contatti</a>
          </div>
          <div class="footer-col">
            <h4 class="footer-col__title">PRODOTTI</h4>
            <a href="prodotti.html#nocciolo">Nocciolo</a>
            <a href="prodotti.html#scopino">Scopino</a>
            <a href="prodotti.html#riccio-pvc">Riccio in PVC</a>
            <a href="prodotti.html#manico-riccio">Manico per riccio</a>
            <a href="prodotti.html#tazze">Tazze</a>
            <a href="prodotti.html#rullino">Rullino portarotoli</a>
          </div>
          <div class="footer-col">
            <h4 class="footer-col__title">LEGALE</h4>
            <a href="privacy.html">Privacy</a>
            <a href="cookie.html">Cookie</a>
            <a href="#" data-cc="show-preferencesModal">Impostazioni cookie</a>
          </div>
        </div>
        <div class="footer-copy">
          <small>Copyright © 2025 Termoseras S.r.l. <br>Tutti i diritti riservati.</small>
          <small>Made in Italy</small>
        </div>
      </div>
    </footer>

    <!-- Cookie banner + Consent Mode -->
    <script type="module">
      import 'https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.1.0/dist/cookieconsent.umd.js';

      function updateGtagConsent() {
        const isGranted = (service, cat) =>
          CookieConsent.acceptedService(service, cat) ? 'granted' : 'denied';
        gtag('consent','update', {
          analytics_storage:     isGranted('analytics_storage','analytics'),
          functionality_storage: isGranted('functionality_storage','functionality'),
          ad_storage: 'denied',
          ad_user_data: 'denied',
          ad_personalization: 'denied'
        });
      }

      CookieConsent.run({
        mode: 'opt-in',
        cookie: { name: 'cc_cookie' },
        guiOptions: {
          consentModal:     { layout: 'cloud inline', position: 'bottom center', equalWeightButtons: true },
          preferencesModal: { layout: 'box' }
        },
        categories: {
          necessary:   { enabled: true, readOnly: true },
          analytics:   {
            autoClear: { cookies: [{ name: /^_ga/ }, { name: '_gid' }] },
            services: {
              analytics_storage: { label: 'Abilita cookie di analisi (Google Analytics 4)' }
            }
          },
        functionality: {
            services: {
              functionality_storage: { label: 'Abilita contenuti esterni (es. moduli, mappe)' }
            }
          }
        },
        language: {
          default: 'it',
          translations: {
            it: {
              consentModal: {
                title: 'Usiamo i cookie',
                description: 'Utilizziamo cookie tecnici e, previo consenso, cookie analitici per migliorare il sito. Puoi accettare tutti o gestire le preferenze.',
                acceptAllBtn: 'Accetta tutti',
                acceptNecessaryBtn: 'Rifiuta non necessari',
                showPreferencesBtn: 'Impostazioni cookie',
                footer: `<a href="privacy.html">Privacy</a> · <a href="cookie.html">Cookie</a>`
              },
              preferencesModal: {
                title: 'Gestisci preferenze cookie',
                acceptAllBtn: 'Accetta tutti',
                acceptNecessaryBtn: 'Rifiuta non necessari',
                savePreferencesBtn: 'Salva preferenze',
                sections: [
                  { title: 'Necessari', description: 'Sempre attivi per il funzionamento del sito.', linkedCategory: 'necessary' },
                  { title: 'Analitici', description: 'Statistiche anonime per migliorare il sito.', linkedCategory: 'analytics' },
                  { title: 'Funzionalità esterne', description: 'Abilita contenuti di terze parti (es. moduli, mappe).', linkedCategory: 'functionality' }
                ]
              }
            }
          }
        },
        onFirstConsent: () => { updateGtagConsent(); window.__syncIM?.(); },
        onConsent:      () => { updateGtagConsent(); window.__syncIM?.(); },
        onChange:       () => { updateGtagConsent(); window.__syncIM?.(); }
      });
    </script>

    <!-- Ricarica una sola volta se si passa da negato→concesso (Analitici o Funzionalità) -->
    <script>
      (function(){
        let prevFn = !!(window.CookieConsent && CookieConsent.acceptedService('functionality_storage','functionality'));
        let prevAn = !!(window.CookieConsent && CookieConsent.acceptedService('analytics_storage','analytics'));
        function maybeReload() {
          if (!window.CookieConsent || !CookieConsent.acceptedService) return;
          const nowFn = CookieConsent.acceptedService('functionality_storage','functionality');
          const nowAn = CookieConsent.acceptedService('analytics_storage','analytics');
          const gained = (nowFn && !prevFn) || (nowAn && !prevAn);
          prevFn = !!nowFn; prevAn = !!nowAn;
          if (gained && !sessionStorage.getItem('cc_reload_once')) {
            sessionStorage.setItem('cc_reload_once','1');
            location.reload();
          }
        }
        document.addEventListener('cc:onConsent', maybeReload);
        document.addEventListener('cc:onChange',  maybeReload);
      })();
    </script>

    <!-- IframeManager -->
    <script defer src="https://cdn.jsdelivr.net/gh/orestbida/iframemanager@1.3.0/dist/iframemanager.js"></script>
    <script>
      (function initIM(){
        if (typeof iframemanager !== 'function') {
          return setTimeout(initIM, 30);
        }
        const im = iframemanager();
        im.run({
          currLang: 'it',
          services: {
            googlemaps: {
              embedUrl: 'https://www.google.com/maps/embed?pb={data-id}',
              iframe: {
                loading: 'lazy',
                referrerpolicy: 'no-referrer-when-downgrade',
                frameborder: '0',
                allowfullscreen: 'true',
                style: 'border:0; display:block; width:100%; height:100%;'
              },
              languages: {
                it: {
                  noticeTitle: '{data-title}',
                  loadBtn: '',
                  loadAllBtn: 'ABILITA COOKIE'
                }
              }
            }
          },
          onChange: ({ changedServices, eventSource }) => {
            if (eventSource?.type === 'click' && changedServices?.includes('googlemaps')) {
              if (window.CookieConsent?.getUserPreferences && CookieConsent.acceptService) {
                const current = new Set(CookieConsent.getUserPreferences()?.acceptedServices?.functionality || []);
                current.add('functionality_storage');
                CookieConsent.acceptService([...current], 'functionality');
              }
              try { syncFromCC(); } catch(e){}
            }
          }
        });

        function syncFromCC() {
          if (!window.CookieConsent?.acceptedService) return;
          const granted = CookieConsent.acceptedService('functionality_storage','functionality');
          if (granted) im.acceptService('googlemaps');
          else im.rejectService('googlemaps');
        }
        window.__syncIM = syncFromCC;
        try { syncFromCC(); } catch(e){}
      })();
    </script>

    <!-- Google Analytics (caricato solo se accetti "Analitici") -->
    <script type="text/plain" data-category="analytics"
            data-service="Google Analytics"
            data-src="https://www.googletagmanager.com/gtag/js?id=G-VLEC2STHFB"></script>
    <script type="text/plain" data-category="analytics" data-service="Google Analytics">
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'G-VLEC2STHFB', { anonymize_ip: true });
    </script>

    <!-- JS: validazione + versioni dinamiche -->
    <script>
      (function() {
        const form = document.getElementById('contact-form');
        const email = document.getElementById('email');
        const tel = document.getElementById('telefono');
        const emailErr = document.getElementById('email-error');
        const telErr = document.getElementById('tel-error');
        const emailWrap = email.closest('.field-wrap');
        const telWrap = tel.closest('.field-wrap');
        let emailTouched = false;
        let telTouched = false;

        function validateEmail(force = false) {
          if (!emailTouched && !force) return true;
          email.setCustomValidity('');
          email.classList.remove('error');
          emailWrap.classList.remove('has-error');
          emailErr.textContent = '';
          const ok = email.checkValidity();
          if (!ok) {
            email.setCustomValidity("Inserisci un'email valida (es. nome@azienda.it).");
            email.classList.add('error');
            emailWrap.classList.add('has-error');
            emailErr.textContent = "Email non valida (es. nome@azienda.it).";
          }
          return ok;
        }

        function validateTel(force = false) {
          if (!telTouched && !force) return true;
          tel.setCustomValidity('');
          tel.classList.remove('error');
          telWrap.classList.remove('has-error');
          telErr.textContent = '';
          if (!tel.value) return true;
          const digits = tel.value.replace(/\D/g, '');
          const okLen = digits.length >= 7 && digits.length <= 15;
          const okChars = /^[0-9()+\-\.\s]+$/.test(tel.value);
          const ok = okLen && okChars;
          if (!ok) {
            tel.setCustomValidity('Inserisci un numero valido (7–15 cifre). Esempio: +39 02 1234567');
            tel.classList.add('error');
            telWrap.classList.add('has-error');
            telErr.textContent = "Numero non valido (7–15 cifre). Esempio: +39 02 1234567.";
          }
          return ok;
        }

        email.addEventListener('blur', () => { emailTouched = true; validateEmail(true); });
        tel.addEventListener('blur', () => { telTouched = true; validateTel(true); });
        email.addEventListener('input', () => { if (emailTouched) validateEmail(true); });
        tel.addEventListener('input', () => { if (telTouched) validateTel(true); });

        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxQJwJCXDVr7Q4qzRck92JnujM9uEkfog8F97rJMBEEP0L8BdU-tlaTfM2nFTFReawP/exec";

        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          const ok1 = validateEmail(true);
          const ok2 = validateTel(true);
          if (!(ok1 && ok2)) {
            if (!ok1) { email.reportValidity(); email.focus(); }
            else { tel.reportValidity(); tel.focus(); }
            return;
          }

          const fd = new FormData(form);
          const tipo = (form.querySelector('input[name="tipo_richiesta"]:checked') || {}).value || "";
          fd.append('tipo', tipo);

          fd.delete('articoli[]');
          Array.from(form.querySelectorAll('input[name="articoli[]"]:checked'))
               .forEach(i => fd.append('articoli[]', i.value));

          fd.delete('versioni[]');
          Array.from(form.querySelectorAll('input[name="versioni[]"]:checked'))
               .forEach(i => fd.append('versioni[]', i.value));

          fd.append('nome', fd.get('nominativo') || "");
          fd.append('privacy', document.getElementById('privacy')?.checked ? 'true' : 'false');

          const statusEl = document.getElementById('form-status');
          const submitBtn = form.querySelector('button[type="submit"]');

          try {
            statusEl.textContent = "Invio in corso…";
            submitBtn.disabled = true;

            await fetch(SCRIPT_URL, {
              method: 'POST',
              mode: 'no-cors',
              body: fd
            });

            statusEl.textContent = "Richiesta inviata con successo. Ti risponderemo a breve.";
            form.reset();

            const vFieldset = document.getElementById('versions-fieldset');
            const vContainer = document.getElementById('versions-container');
            if (vContainer) vContainer.innerHTML = "";
            if (vFieldset) vFieldset.hidden = true;

          } catch (err) {
            statusEl.textContent = "Errore di rete. Controlla la connessione e riprova.";
          } finally {
            submitBtn.disabled = false;
          }
        });

        const versionsMap = {
          nocciolo: ["Nocciolo — Inserto in ottone M/F (M5/M6/M8/M10)", "Nocciolo — Gancio rapido bloccante (fori Ø 8/10/12)"],
          scopino: ["Scopino — Compatto con inserto in ottone (5/8/10/12/14/17 cm)", "Scopino — Perno laterale pieghevole (50/100 cm)"],
          riccio: ["Riccio — Piccolo Ø 50 mm", "Riccio — Medio Ø 60 mm", "Riccio — Grande Ø 70 mm"],
          manico: ["Manico — 50/120 mm — M5/M6", "Manico — 140/170 mm — M5/M6"],
          tazze: ["Tazza — Ø 75 mm — h 120 mm", "Tazza — Ø 85 mm — h 120 mm"],
          rullino: ["Rullino — Corsa 95–125 mm"]
        };
        const artList = document.getElementById('articoli-list');
        const vFieldset = document.getElementById('versions-fieldset');
        const vContainer = document.getElementById('versions-container');

        function updateVersions() {
          const selectedKeys = Array.from(artList.querySelectorAll('input[type="checkbox"]:checked')).map(i => i.dataset.key);
          vContainer.innerHTML = '';
          if (selectedKeys.length === 0) {
            vFieldset.hidden = true;
            return;
          }
          selectedKeys.forEach(key => {
            const list = versionsMap[key] || [];
            if (list.length === 0) return;
            const title = document.createElement('div');
            title.className = 'legend';
            title.textContent = (artList.querySelector(`[data-key="${key}"]`)?.value) || key;
            vContainer.appendChild(title);
            const grid = document.createElement('div');
            grid.className = 'checks-grid';
            list.forEach(label => {
              const wrapper = document.createElement('label');
              wrapper.className = 'check';
              const input = document.createElement('input');
              input.type = 'checkbox';
              input.name = 'versioni[]';
              input.value = label;
              const span = document.createElement('span');
              span.textContent = label;
              wrapper.appendChild(input);
              wrapper.appendChild(span);
              grid.appendChild(wrapper);
            });
            vContainer.appendChild(grid);
          });
          vFieldset.hidden = false;
        }
        artList.addEventListener('change', updateVersions);

        const params = new URLSearchParams(location.search);
        const qs = params.getAll('articolo');
        if (qs.length) {
          qs.forEach(q => {
            const key = q.toLowerCase();
            const input = Array.from(artList.querySelectorAll('input[type="checkbox"]'))
              .find(i => i.dataset.key === key || i.value.toLowerCase() === key);
            if (input) input.checked = true;
          });
          updateVersions();
        }
      })();
    </script>
  </body>

  <script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      const reg = await navigator.serviceWorker.register('./sw.js', { scope: './' });
      console.log('SW registrato:', reg.scope);
    } catch (e) {
      console.error('SW errore registrazione:', e);
    }
  });
}
</script>


</html>
